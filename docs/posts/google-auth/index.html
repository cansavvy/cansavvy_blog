<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Candace Savonen">
<meta name="dcterms.date" content="2023-04-19">

<title>cansavvy::Candy_Bytes() - R package Google Authorization for Dummies</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">cansavvy::Candy_Bytes()</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://www.cansavvy.com/" rel="" target="">
 <span class="menu-text">cansavvy.com</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/cansavvy" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://forms.gle/muRJQALEacH8mJaS7" rel="" target="">
 <span class="menu-text">Subscribe!</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">R package Google Authorization for Dummies</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">code</div>
                <div class="quarto-category">analysis</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Candace Savonen </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 19, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>For quite some time, I’ve always wanted to unlock the powers of using Google API in an R package but the authorization bit had always puzzled me!</p>
<p>This is not to say that others have not done a lot of great work in this topic of R packages and Google API! There are a lot of great R packages with documentation out there to help you do this. Three in particular:</p>
<ul>
<li><a href="https://gargle.r-lib.org/articles/get-api-credentials.html">How to get your own API credentials</a></li>
<li><a href="https://code.markedmondson.me/googleAuthR/">googleAuthR</a></li>
<li><a href="https://blog.r-hub.io/2021/01/25/oauth-2.0/">How to deal with OAuth2.0 in R packages?</a></li>
</ul>
<p>But it seems like the people who understand it: understand it. And the rest of us are left confused!</p>
<p>I still didn’t understand how to know what kinds of credentials I needed and I always found myself lost in a lacking the correct permissions loop!</p>
<p>But! I figured it out! And I figured this is a good time to write about it.</p>
<div style="width:480px">
<iframe allow="fullscreen" frameborder="0" height="270" src="https://giphy.com/embed/REsujhxE5IKrAvvW1V/video" width="480">
</iframe>
</div>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>Google has a load of different apps that are free, online and useful in a daily project workflow.</p>
<p>First off, what’s an API? It stands for <code>Application Programming Interface</code>. Why am I so excited about having figured this out? APIs are powerful because they allow different computer programs to talk to each other and share information. This means that I (and hopefully you after this blogpost) can use existing tools and features to build new applications faster and more easily. It’s like being able to borrow a tool from a friend instead of having to build it from scratch yourself.</p>
<p>Let me explain my particular use case:</p>
<p>I was working on putting a bunch of files on to Google and set them up on Google Classroom. To do this, was very tedious. I had a lot of steps I had to perform for each…and every… individual file.</p>
<p>There’s gotta be a better way than all this tedious work!</p>
<iframe src="https://giphy.com/embed/5WXqTFTgO9a7e" width="480" height="339" frameborder="0" class="giphy-embed" allowfullscreen="">
</iframe>
<p>
<a href="https://giphy.com/gifs/sassy-model-5WXqTFTgO9a7e">via GIPHY</a>
</p>
<p>If only there was a way I could write a script that could do this all for me at the call of one script! Spoiler alert: There is and I figured it out!</p>
<p>But before I could write such a script, I had to be able to get access to the data that is on an Google API, and to do that I needed to figure out authorization.</p>
<p>Authorization is just a way to tell an App like Google - hey! It’s me, its okay, you can share this data! People do authorization steps all the time when they use their usernames and passwords to login to things. But usernames and passwords are a simpler form of authorization. And when it comes to APIs, these are often not secure enough to keep all this data safe.</p>
</section>
<section id="a-dummys-rundown-on-the-auth-types" class="level2">
<h2 class="anchored" data-anchor-id="a-dummys-rundown-on-the-auth-types">A dummy’s rundown on the auth types</h2>
<p>It’s me! I’m the dummy! The first place that people would always lose me is the authorization types.</p>
<ul>
<li><p><code>Basic Authentication</code>: Basic authentication is a simple authentication method that sends a username and password in plain text with each request to the API. While easy to implement, it is also very insecure because the credentials are sent in plain text and can be intercepted by anyone with access to the network traffic.</p></li>
<li><p><code>OAuth 2.0</code>: OAuth stands for <code>Open Authorization</code>. It’s an authorization protocol that is widely used by a lot of different websites. The name reflects the fact that the OAuth protocol is designed to provide an open and standardized way for different systems to authorize and authenticate access to protected resources. The 2.0 part just refers to the fact that there was a OAuth 1.0 that is not quite as secure.</p></li>
<li><p><code>API Keys</code> and <code>Personal Access Tokens</code> - these are less secure ways of authorization but more convenient. They are often special strings of characters, symbols and numbers that you can supply to authorize the API to release your data.</p></li>
</ul>
</section>
<section id="the-goal" class="level2">
<h2 class="anchored" data-anchor-id="the-goal">The goal</h2>
<p>If you create an app that uses one of these APIs usually you’ll see a kind of authorization screen like this:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/images/index_files/figure-html//18TXez7_1U2TKxe5G0XPOm84EpYWB6n19MbQeMcqJeaQ_g2371c5437bc_0_0.png" class="img-fluid figure-img" style="width:100.0%" alt="A google app authorization screen"></p>
</figure>
</div>
</div>
</div>
<p>But what if I’m making the app? How do I make this screen show up so others can use my package to access their own Google data?</p>
</section>
<section id="the-meat-and-potaters" class="level2">
<h2 class="anchored" data-anchor-id="the-meat-and-potaters">The meat and potaters</h2>
<p>Okay, so how do you create an app that does the authorization thing for a Google API?</p>
<section id="step-1-make-a-google-cloud-account" class="level3">
<h3 class="anchored" data-anchor-id="step-1-make-a-google-cloud-account">Step 1) Make a Google Cloud account</h3>
<p>Go to the Google Developers Console at https://console.developers.google.com/.</p>
<p>If you don’t have an account yet, it will tell you. Make an account! It’s free assuming you aren’t doing anything crazy.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/images/index_files/figure-html//18TXez7_1U2TKxe5G0XPOm84EpYWB6n19MbQeMcqJeaQ_g232d09b7a8a_0_0.png" class="img-fluid figure-img" style="width:100.0%" alt="Go to https://console.cloud.google.com/ and make an account!"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="step-2-make-a-new-project" class="level3">
<h3 class="anchored" data-anchor-id="step-2-make-a-new-project">Step 2) Make a new project</h3>
<p>Now you’ll need to make a project. Go to <code>Select Project</code> in the menu bar.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/images/index_files/figure-html//18TXez7_1U2TKxe5G0XPOm84EpYWB6n19MbQeMcqJeaQ_g232d09b7a8a_0_7.png" class="img-fluid figure-img" style="width:100.0%" alt="Go to Select Project"></p>
</figure>
</div>
</div>
</div>
<p>Click “New Project.”</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/images/index_files/figure-html//18TXez7_1U2TKxe5G0XPOm84EpYWB6n19MbQeMcqJeaQ_g232d09b7a8a_0_14.png" class="img-fluid figure-img" style="width:100.0%" alt="Go to Select Project"></p>
</figure>
</div>
</div>
</div>
<p>Give your project a name – whatever will remind you of what this is for – and click “Create.”</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/images/index_files/figure-html//18TXez7_1U2TKxe5G0XPOm84EpYWB6n19MbQeMcqJeaQ_g232d09b7a8a_0_20.png" class="img-fluid figure-img" style="width:100.0%" alt="Name your project"></p>
</figure>
</div>
</div>
</div>
<p>You’ll be in your project’s Dashboard after you create it. You can return here by clicking on this left side menu and going to Cloud Overview &gt; Dashboard (sometimes this left side menu hides but you can click the three lines to bring it back out).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/images/index_files/figure-html//18TXez7_1U2TKxe5G0XPOm84EpYWB6n19MbQeMcqJeaQ_g232d09b7a8a_0_25.png" class="img-fluid figure-img" style="width:100.0%" alt="Name your project"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="step-3-enable-the-api-you-are-looking-to-use" class="level3">
<h3 class="anchored" data-anchor-id="step-3-enable-the-api-you-are-looking-to-use">Step 3) Enable the API you are looking to use</h3>
<p>First you have to enable whatever Google App you want to interact with: Googlesheets, Googledrive, Googleforms, Googleclassroom, etc.</p>
<p>To do this go to that left-had menu and go to click <code>APIs &amp; Services</code> and then to <code>Enable APIs &amp; Services</code>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/images/index_files/figure-html//18TXez7_1U2TKxe5G0XPOm84EpYWB6n19MbQeMcqJeaQ_g232d09b7a8a_0_35.png" class="img-fluid figure-img" style="width:100.0%" alt="Name your project"></p>
</figure>
</div>
</div>
</div>
<p>On this page, you need to search for that Google app you want access to. Click on the one you want and then on its page, click <code>Enable</code>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/images/index_files/figure-html//18TXez7_1U2TKxe5G0XPOm84EpYWB6n19MbQeMcqJeaQ_g232d09b7a8a_0_42.png" class="img-fluid figure-img" style="width:100.0%" alt="Name your project"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="step-4-get-credentials-oauth-2.0-kind" class="level3">
<h3 class="anchored" data-anchor-id="step-4-get-credentials-oauth-2.0-kind">Step 4) Get credentials (OAuth 2.0 kind)</h3>
<p>We’ve enabled the API, but to really use it we need to have credentials so our package is allowed to interact with the API and we don’t have just any random person accessing our Google data.</p>
<p>Google will probably suggest to you to <code>Create credentials</code> click on this button. But you can also get to the Credentials page by clicking on `Credentials on the left hand side.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/images/index_files/figure-html//18TXez7_1U2TKxe5G0XPOm84EpYWB6n19MbQeMcqJeaQ_g232d09b7a8a_0_20.png" class="img-fluid figure-img" style="width:100.0%" alt="Name your project"></p>
</figure>
</div>
</div>
</div>
<p>Click on the “Create credentials” button and select “OAuth client ID” or if you aren’t sure you can say <code>Help me choose</code>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/images/index_files/figure-html//18TXez7_1U2TKxe5G0XPOm84EpYWB6n19MbQeMcqJeaQ_g232d09b7a8a_0_130.png" class="img-fluid figure-img" style="width:100.0%" alt="Create credentials"></p>
</figure>
</div>
</div>
</div>
<p>Select the Google program that you want to interact with (the one we enabled before). And tell it we would like to collect <code>User data</code>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/images/index_files/figure-html//18TXez7_1U2TKxe5G0XPOm84EpYWB6n19MbQeMcqJeaQ_g232d09b7a8a_0_58.png" class="img-fluid figure-img" style="width:100.0%" alt="Choose the API and then select User data"></p>
</figure>
</div>
</div>
</div>
<p>Now we need to supply info for what our OAuth screen that asks the user if they are okay with sending their data to our package. Put the name of your package as you would like users to see it. And put the email they should contact you with any problems with. Then go to the Next step.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/images/index_files/figure-html//18TXez7_1U2TKxe5G0XPOm84EpYWB6n19MbQeMcqJeaQ_g232d09b7a8a_0_66.png" class="img-fluid figure-img" style="width:100.0%" alt="Put your email and name of your package so users see it on the OAuth page."></p>
</figure>
</div>
</div>
</div>
<p>Put a logo if you would like and then add your email here as well.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/images/index_files/figure-html//18TXez7_1U2TKxe5G0XPOm84EpYWB6n19MbQeMcqJeaQ_g232d09b7a8a_0_72.png" class="img-fluid figure-img" style="width:100.0%" alt="Putting your email on the OAuth screen"></p>
</figure>
</div>
</div>
</div>
<p>Now we have to tell it what scopes we need. Scopes are basically what privileges to what data your package is going to have. If you don’t have the right scopes, your package won’t have permissions to do anything. If you have too many apps, that is <a href="https://csrc.nist.gov/glossary/term/least_privilege#:~:text=Definition(s)%3A,needs%20to%20perform%20its%20function.">unnecessarily dangerous to have more permissions than you need</a>.</p>
<p>Click Add/Remove scopes.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/images/index_files/figure-html//18TXez7_1U2TKxe5G0XPOm84EpYWB6n19MbQeMcqJeaQ_g232d09b7a8a_0_78.png" class="img-fluid figure-img" style="width:100.0%" alt="Name your project"></p>
</figure>
</div>
</div>
</div>
<p>Search first for the API you are looking for. For this example, we will use <code>googlesheets</code>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/images/index_files/figure-html//18TXez7_1U2TKxe5G0XPOm84EpYWB6n19MbQeMcqJeaQ_g232d09b7a8a_0_58.png" class="img-fluid figure-img" style="width:100.0%" alt="Name your project"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/images/index_files/figure-html//18TXez7_1U2TKxe5G0XPOm84EpYWB6n19MbQeMcqJeaQ_g232d09b7a8a_0_90.png" class="img-fluid figure-img" style="width:100.0%" alt="Narrow down the scopes"></p>
</figure>
</div>
</div>
</div>
<p>Think about what you would like your package to do, and choose the scopes that relate to it. For example, is your package only going to read in a googlesheet but won’t edit it? Then choose a <code>read.only</code> scope that pertains to <code>googlesheets</code>. Read the <code>user-facing Description</code> to get an idea of what each will do. When you look in the Google Reference Guide, the methods pages will list the scopes needed toward the bottom of the page.</p>
<p>You can come back to edit these if you need. So don’t worry too much about getting it exactly right, right now.</p>
<p>The ones you do choose, be sure to write them down in a scratch file somewhere because you’ll need to know what they were later.</p>
<p>Click <code>Update</code> when you have the scopes you think you need.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/images/index_files/figure-html//18TXez7_1U2TKxe5G0XPOm84EpYWB6n19MbQeMcqJeaQ_g232d09b7a8a_0_96.png" class="img-fluid figure-img" style="width:100.0%" alt="Choose the scopes"></p>
</figure>
</div>
</div>
</div>
<p>Now you’ve added the scopes. Go to the next page.</p>
<p>For this scenario we will select “Desktop app”. But if you were making a Shiny App you would choose “Web Application.”</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/images/index_files/figure-html//18TXez7_1U2TKxe5G0XPOm84EpYWB6n19MbQeMcqJeaQ_g232d09b7a8a_0_108.png" class="img-fluid figure-img" style="width:100.0%" alt="Choosing Desktop App"></p>
</figure>
</div>
</div>
</div>
<p>Put a title for these credentials that will remind you want you are using them for.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/images/index_files/figure-html//18TXez7_1U2TKxe5G0XPOm84EpYWB6n19MbQeMcqJeaQ_g232d09b7a8a_0_113.png" class="img-fluid figure-img" style="width:100.0%" alt="Name the credentials"></p>
</figure>
</div>
</div>
</div>
<p>Now download these credentials. Be careful with these! You don’t want others to have them so don’t load them to GitHub. (Add the file to your .gitignore).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/images/index_files/figure-html//18TXez7_1U2TKxe5G0XPOm84EpYWB6n19MbQeMcqJeaQ_g232d09b7a8a_0_122.png" class="img-fluid figure-img" style="width:100.0%" alt="Name the credentials"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="step-3-what-do-the-credentials-look-like" class="level3">
<h3 class="anchored" data-anchor-id="step-3-what-do-the-credentials-look-like">Step 3) What do the credentials look like?</h3>
<p>It’s a JSON file that has information:</p>
<pre><code>{"installed":
  {"client_id":"abunchoflettersandnumbershere.apps.googleusercontent.com",
   "project_id":"some-words-for-your-projectid",
   "auth_uri":"https://accounts.google.com/o/oauth2/auth",
   "token_uri":"https://oauth2.googleapis.com/token","auth_provider_x509_cert_url":"https://www.googleapis.com/oauth2/v1/certs",
   "client_secret":"another-jumble-of-letters-and-numbers-here",
   "redirect_uris":["http://localhost"]
   }
  }</code></pre>
<p>The client ID and the client secret are what we are gonna need for our package.</p>
</section>
<section id="step-4-using-the-credentials-in-an-r-package" class="level3">
<h3 class="anchored" data-anchor-id="step-4-using-the-credentials-in-an-r-package">Step 4) Using the credentials in an R package</h3>
<p>Start up an R Package. I follow <a href="https://r-pkgs.org/setup.html">Hadley’s R Package book everytime</a>.</p>
<p>There are a lot of ways to have users authorize the app, and perhaps some might be more secure than this. I’m a newb at this.</p>
<p>Here’s the packages we’ll need:</p>
<pre><code>install.packages("httr") 
install.packages("gargle") 
install.packages("jsonlite") </code></pre>
<p>First, I’m going to take my credentials and read them in and save them to an RDS. I’m going to bury this RDS in the package and I’m not uploading this code to my repository.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in the creds</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>creds <span class="ot">&lt;-</span> jsonlite<span class="sc">::</span><span class="fu">read_json</span>(<span class="fu">list.files</span>(<span class="at">path =</span> <span class="fu">file.path</span>(root_dir, <span class="st">".secrets"</span>), </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">pattern =</span> <span class="st">"client_secret_"</span>, </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">full.names =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Save creds to an RDS</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(<span class="fu">list</span>(<span class="at">client_id =</span> creds<span class="sc">$</span>installed<span class="sc">$</span>client_id,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">client_secret =</span> creds<span class="sc">$</span>installed<span class="sc">$</span>client_secret),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">file.path</span>(<span class="sc">&lt;</span>some buried file <span class="cf">in</span> my package<span class="sc">&gt;</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>First let’s make a file called <code>auth.R</code> or something like that.</p>
<p>In this file, define your scopes that you wrote down when you made the OAuth bits:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>scopes <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://www.googleapis.com/auth/spreadsheets"</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://www.googleapis.com/auth/spreadsheets.readonly"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://www.googleapis.com/auth/drive"</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://www.googleapis.com/auth/drive.readonly"</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://www.googleapis.com/auth/drive.file"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A couple more terms to define before we get into some more code:</p>
<ul>
<li><strong>endpoint</strong> - its just a URL where the thing we want is located.</li>
<li><strong>token</strong> - generally referring to the OAuth token we are going to send Google to get permission to see the things we want to see.</li>
<li><strong>encyption</strong> - a way for us to hide a file from others.</li>
<li><strong>encryption key</strong> - there’s a lot of ways to encrypt, but the way we did it here is called symmetric encryption in that we give it a key we make up when we encrypt the thing and then to decrypt it we have to give it back that same key.</li>
</ul>
<p>First, some token managing bits (note that a lot of this code is adapted or inspired by <a href="https://github.com/hairizuanbinnoorazman/rgoogleslides">rgoogleslides</a>).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I can tell people to use the authorize_sheets() function when they start up</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>.onAttach <span class="ot">&lt;-</span> <span class="cf">function</span>(libname, pkgname) {</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">packageStartupMessage</span>(<span class="st">"Use authorize_sheets() function to begin."</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># I can make an empty environment where the token will be stored when we have it so that its not just out in the open. </span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>.packageEnv <span class="ot">&lt;-</span> <span class="fu">new.env</span>(<span class="at">parent =</span> <span class="fu">emptyenv</span>())</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># For now the Token is gonna be NULL because we don't have it yet. </span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>.packageEnv<span class="sc">$</span>Token <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># A function to set token to environment</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>set_token <span class="ot">&lt;-</span> <span class="cf">function</span>(value) {</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  .packageEnv<span class="sc">$</span>Token <span class="ot">&lt;-</span> value</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(value)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># A function to retrieveGet token from environment</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>get_token <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  .packageEnv<span class="sc">$</span>Token</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now for the meat and potaters. This is the function that people will run to actually authorize the package to use their google data.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">authorize_sheets</span>() <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">token =</span> <span class="cn">NULL</span>, ...) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># I stored the credentials as an encrypted RDS</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># I'm not going to show this bit for security reasons -- but you can figure out your own encryption and security measures. </span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Look at the openssl package. </span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If there isn't a token supplied, it will get one from the RDS</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(token)) {</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This is a nifty function from gargle to set up our app</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    app <span class="ot">&lt;-</span> gargle<span class="sc">::</span><span class="fu">oauth_app</span>(</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">appname =</span> <span class="st">"google-api-r-package"</span>,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>      <span class="co"># These are just strings that are derived from the credentials JSON we downloaded</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">key =</span> <span class="sc">&lt;</span>client_id from json<span class="sc">/</span>rds<span class="sc">&gt;</span> ,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">secret =</span> <span class="sc">&lt;</span>client_secret from json<span class="sc">/</span>rds<span class="sc">&gt;</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the httr package has the google endpoints</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    endpoint <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">oauth_endpoints</span>(<span class="st">"google"</span>)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Now we put everything all together to make the token</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    token <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">oauth2.0_token</span>(</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">endpoint =</span> endpoint, </span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">app =</span> app,</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">scope =</span> scopes_list,</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>      ...</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Now the token is set to the environment so we don't have to do this again</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_token</span>(token)</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make it invisible for security</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>(token))</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now we should be able to test this!</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>() </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">authorize_sheets</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If running this brings up the authorization screen for you, you’ve probably successfully authorized your package!</p>
<p>To test this: here’s what your basic API function would look like.</p>
<p>When building your API wrapper functions, you will heavily depend on the Google API reference guide. In this case, we’d reference the sheets reference guide: https://developers.google.com/sheets/api/guides/concepts</p>
<p>Also when people say <code>REST</code>ful it’s referring to that you use these URLs to get stuff from APIs. It includes some actions like:</p>
<ul>
<li><code>GET</code> - to collect info from some existing stuff</li>
<li><code>POST</code> to create new stuff</li>
<li><code>DELETE</code> to, well, delete stuff</li>
<li><code>PATCH</code> - to update existing stuff</li>
</ul>
<p>This is what we will use the <code>httr</code> package for. So install that if you don’t have it.</p>
<p>That’s the basics.</p>
<p>Now let’s create a test API wrapper function in a separate file in our <code>R</code> folder.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' Get Google Sheet properties</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param id ID of the googlesheet as a character string. A google sheet ID can be found in the URL like https://docs.google.com/spreadsheets/d/&lt;sheet-id-is-here&gt;/edit#gid=0</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom httr config accept_json content</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom jsonlite fromJSON</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom assertthat assert_that is.string</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">#' @example \dontrun {</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co">#' authorize_sheets()</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_sheet_properties("13iMGreQq3myZXCflAWfkpXMlgG8Q1bjp-9iuKGfiQFk/")</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co">#' }</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>get_sheet_properties <span class="ot">&lt;-</span> <span class="cf">function</span>(sheet_id) {</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make sure this is a string</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assert_that</span>(<span class="fu">is.string</span>(sheet_id))</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Here's the endpoint URL we found from the documentation here: https://developers.google.com/drive/api/v3/reference/files/get</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> <span class="st">"https://www.googleapis.com/drive/v3/files/"</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get auth token that was stored when we did `authorize_sheets()`</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  token <span class="ot">&lt;-</span> <span class="fu">get_token</span>()</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We're putting this in a format that the API can take</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  config <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">config</span>(<span class="at">token =</span> token)</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Now we are using that GET REST method. Note we are passing in our token with the config and we are telling it to return a JSON file. </span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(url, <span class="at">config =</span> config, <span class="fu">accept_json</span>())</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If something doesn't work, we want to know. </span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (httr<span class="sc">::</span><span class="fu">status_code</span>(result) <span class="sc">!=</span> <span class="dv">200</span>) {</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"We didn't get the sheet we tried to get. "</span>)</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>    httr<span class="sc">::</span><span class="fu">stop_for_status</span>(result)</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract content</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  result_content <span class="ot">&lt;-</span> <span class="fu">content</span>(result, <span class="st">"text"</span>)</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Read from the JSON it gave us and make it a list in R</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>  result_list <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(result_content)</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return that list</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result_list)</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Great! Now if we run this to test:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>() </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">authorize_sheets</span>()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>sheet_properties <span class="ot">&lt;-</span> <span class="fu">get_sheet_properties</span>(<span class="st">"sheet-id-here"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Holy sheet!</p>
<iframe src="https://giphy.com/embed/CuMiNoTRz2bYc" width="480" height="240" frameborder="0" class="giphy-embed" allowfullscreen="">
</iframe>
<p>
<a href="https://giphy.com/gifs/giphyqa-CuMiNoTRz2bYc">via GIPHY</a>
</p>
<p>Hopefully that worked! And hopefully you are off to the races for making your very own API wrapper.</p>
</section>
</section>
<section id="troubleshooting-tip" class="level2">
<h2 class="anchored" data-anchor-id="troubleshooting-tip">Troubleshooting Tip</h2>
<p>On a lot of the Google API reference pages they have a <code>Try it out</code> thingy. This is super helpful for testing things:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/images/index_files/figure-html//18TXez7_1U2TKxe5G0XPOm84EpYWB6n19MbQeMcqJeaQ_g2371c5435f5_0_0.png" class="img-fluid figure-img" style="width:100.0%" alt="Try it out thing on Google API reference is helpful"></p>
</figure>
</div>
</div>
</div>
<script src="https://utteranc.es/client.js" repo="cansavvy/cansavvy_blog" issue-term="title" label="Commenter on blog post" theme="boxy-light" crossorigin="anonymous" async="">
</script>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.1.2 (2021-11-01)
Platform: x86_64-apple-darwin17.0 (64-bit)
Running under: macOS Big Sur 10.16

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRblas.0.dylib
LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

loaded via a namespace (and not attached):
 [1] rstudioapi_0.13   knitr_1.43        magrittr_2.0.3    hms_1.1.2        
 [5] R6_2.5.1.9000     rlang_1.1.1       fastmap_1.1.1     fansi_1.0.4      
 [9] httr_1.4.6        tools_4.1.2       xfun_0.39         utf8_1.2.3       
[13] cli_3.6.1         htmltools_0.5.2   ellipsis_0.3.2    ottrpal_1.0.1    
[17] yaml_2.3.7        digest_0.6.33     tibble_3.2.1      lifecycle_1.0.3  
[21] tzdb_0.3.0        readr_2.1.3       htmlwidgets_1.5.4 vctrs_0.6.3      
[25] fs_1.6.2          curl_5.0.1        glue_1.6.2        evaluate_0.21    
[29] rmarkdown_2.20    compiler_4.1.2    pillar_1.9.0      jsonlite_1.8.7   
[33] pkgconfig_2.0.3  </code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>